<theme-toggle>
    <button class="relative h-5 w-5 transition-all" type="button">
        <span class="sr-only">Dark Theme</span>
        <svg
            aria-hidden="true"
            class="absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0"
            fill="none"
            focusable="false"
            id="sun-svg"
            stroke-width="1.5"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M22 12L23 12"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M12 2V1"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M12 23V22"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M20 20L19 19"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M20 4L19 5"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M4 20L5 19"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M4 4L5 5"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M1 12L2 12"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
        </svg>
        <svg
            id="moon-svg"
            aria-hidden="true"
            class="absolute start-1/2 top-[40%] h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100"
            focusable="false"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 256 256"
            ><path
                d="M240,96a8,8,0,0,1-8,8H216v16a8,8,0,0,1-16,0V104H184a8,8,0,0,1,0-16h16V72a8,8,0,0,1,16,0V88h16A8,8,0,0,1,240,96ZM144,56h8v8a8,8,0,0,0,16,0V56h8a8,8,0,0,0,0-16h-8V32a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16Zm72.77,97a8,8,0,0,1,1.43,8A96,96,0,1,1,95.07,37.8a8,8,0,0,1,10.6,9.06A88.07,88.07,0,0,0,209.14,150.33,8,8,0,0,1,216.77,153Zm-19.39,14.88c-1.79.09-3.59.14-5.38.14A104.11,104.11,0,0,1,88,64c0-1.79,0-3.59.14-5.38A80,80,0,1,0,197.38,167.86Z"
            ></path></svg
        >
    </button>
</theme-toggle>

<script>
    // Note that if you fire the theme-change event outside of this component, it will not be reflected in the button's aria-checked attribute
    import { rootInDarkMode } from '../utils';

    class ThemeToggle extends HTMLElement {
        #controller: AbortController | undefined;

        connectedCallback() {
            const button = this.querySelector('button')!;
            // set aria role value
            button.setAttribute('role', 'switch');
            button.setAttribute('aria-checked', String(rootInDarkMode()));
            // Abort signal
            const { signal } = (this.#controller = new AbortController());

            // button event
            button.addEventListener(
                'click',
                () => {
                    // invert theme
                    let themeChangeEvent = new CustomEvent('theme-change', {
                        detail: {
                            theme: rootInDarkMode() ? 'light' : 'dark',
                        },
                    });
                    // dispatch event -> ThemeProvider.astro
                    document.dispatchEvent(themeChangeEvent);

                    // set the aria-checked attribute
                    button.setAttribute(
                        'aria-checked',
                        String(rootInDarkMode())
                    );
                },
                { signal }
            );
        }

        disconnectedCallback() {
            this.#controller?.abort();
        }
    }

    customElements.define('theme-toggle', ThemeToggle);
</script>
